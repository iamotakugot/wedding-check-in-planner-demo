{
  "rules": {
    "guests": {
      // üîß DevOps Fix: ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ user ‡∏ó‡∏µ‡πà login ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡πà‡∏≤‡∏ô guests ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ getGuestByRsvpUid ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ)
      // ‡πÅ‡∏ï‡πà‡∏à‡∏∞ filter ‡∏ù‡∏±‡πà‡∏á client ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Guest ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      // Admin ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏î‡πâ
      ".read": "auth != null",
      "$guestId": {
        // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ user ‡∏≠‡πà‡∏≤‡∏ô Guest ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (rsvpUid === auth.uid) ‡πÅ‡∏•‡∏∞ admin ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        ".read": "auth != null && (root.child('admins').child(auth.uid).exists() || (data.exists() && data.child('rsvpUid').val() === auth.uid))",
        // üîí Security: Admin ‡∏´‡πâ‡∏≤‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Guest ‡∏ú‡πà‡∏≤‡∏ô RSVP flow (Firebase Rules ‡∏à‡∏∞‡∏ö‡∏•‡πá‡∏≠‡∏Å: !root.child('admins').child(auth.uid).exists())
        // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ admin ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Guest ‡∏ú‡πà‡∏≤‡∏ô admin panel ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ user ‡∏™‡∏£‡πâ‡∏≤‡∏á Guest ‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏°‡∏µ rsvpUid === auth.uid (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà admin)
        // ‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ user ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Guest ‡∏ó‡∏µ‡πà‡∏°‡∏µ rsvpUid === auth.uid (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà admin)
        ".write": "auth != null && (root.child('admins').child(auth.uid).exists() || (!root.child('admins').child(auth.uid).exists() && ((!data.exists() && newData.child('rsvpUid').val() === auth.uid) || (data.exists() && data.child('rsvpUid').val() === auth.uid && newData.child('rsvpUid').val() === auth.uid))))",
        // üîß DevOps Fix: Validate ‡∏ß‡πà‡∏≤ rsvpUid ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö auth.uid (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà admin)
        // üîí Security: Admin ‡∏´‡πâ‡∏≤‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á Guest ‡∏ú‡πà‡∏≤‡∏ô RSVP flow (Firebase Rules ‡∏à‡∏∞‡∏ö‡∏•‡πá‡∏≠‡∏Å: !root.child('admins').child(auth.uid).exists())
        ".validate": "!newData.exists() || root.child('admins').child(auth.uid).exists() || (!root.child('admins').child(auth.uid).exists() && newData.hasChildren(['rsvpUid']) && newData.child('rsvpUid').val() === auth.uid)"
      }
    },
    "zones": {
      ".read": "auth != null && root.child('admins').child(auth.uid).exists()",
      ".write": "auth != null && root.child('admins').child(auth.uid).exists()"
    },
    "tables": {
      ".read": "auth != null && root.child('admins').child(auth.uid).exists()",
      ".write": "auth != null && root.child('admins').child(auth.uid).exists()"
    },
    "rsvps": {
      // üîß DevOps Fix: ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ user ‡∏ó‡∏µ‡πà login ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡πà‡∏≤‡∏ô RSVP ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ getRSVPByUid ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ)
      // ‡πÅ‡∏ï‡πà‡∏à‡∏∞ filter ‡∏ù‡∏±‡πà‡∏á client ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô RSVP ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      // Admin ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏î‡πâ
      ".read": "auth != null",
      "$rsvpId": {
        // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ user ‡∏≠‡πà‡∏≤‡∏ô RSVP ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞ admin ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        ".read": "auth != null && (root.child('admins').child(auth.uid).exists() || data.child('uid').val() === auth.uid)",
        // üîß DevOps: Admin ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï RSVP ‡πÑ‡∏î‡πâ (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï guestId ‡∏´‡∏•‡∏±‡∏á import)
        // User (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà admin) ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç RSVP ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        ".write": "auth != null && (root.child('admins').child(auth.uid).exists() || (!root.child('admins').child(auth.uid).exists() && ((!data.exists() && newData.child('uid').val() === auth.uid) || (data.exists() && data.child('uid').val() === auth.uid && newData.child('uid').val() === auth.uid))))",
        ".validate": "!newData.exists() || root.child('admins').child(auth.uid).exists() || (!root.child('admins').child(auth.uid).exists() && newData.child('uid').val() === auth.uid)"
      }
    },
    "config": {
      ".read": true,
      ".write": "auth != null && root.child('admins').child(auth.uid).exists()"
    },
    "admins": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid"
      },
      ".read": false,
      ".write": false
    },
    "userSessions": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid && !root.child('admins').child(auth.uid).exists()",
        "isOnline": {
          ".write": "auth != null && auth.uid === $uid && !root.child('admins').child(auth.uid).exists()"
        },
        "startedAt": {
          ".write": "auth != null && auth.uid === $uid && !root.child('admins').child(auth.uid).exists()"
        },
        "sessionId": {
          ".write": "auth != null && auth.uid === $uid && !root.child('admins').child(auth.uid).exists()"
        }
      },
      ".read": false,
      ".write": false
    },
    "adminSessions": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid && root.child('admins').child(auth.uid).exists()",
        "isOnline": {
          ".write": "auth != null && auth.uid === $uid && root.child('admins').child(auth.uid).exists()"
        },
        "startedAt": {
          ".write": "auth != null && auth.uid === $uid && root.child('admins').child(auth.uid).exists()"
        },
        "sessionId": {
          ".write": "auth != null && auth.uid === $uid && root.child('admins').child(auth.uid).exists()"
        }
      },
      ".read": false,
      ".write": false
    },
    "userAppState": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      },
      ".read": false,
      ".write": false
    },
    "adminAppState": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid && root.child('admins').child(auth.uid).exists()",
        ".write": "auth != null && auth.uid === $uid && root.child('admins').child(auth.uid).exists()"
      },
      ".read": false,
      ".write": false
    }
  }
}
